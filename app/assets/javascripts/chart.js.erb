var responseText;

$(document).ready(function() {
	/*
	$('.edit_chart').on("ajax:success", function(e, data, status, xhr) {
		$('#preview-image').attr('src', xhr.responseText);
		console.log("Success");
		console.log(xhr.responseText);
	}).on("ajax:error", function(e, xhr, status, error) {
	    // $(".edit_chart").append ("error json: " + jQuery.parseJSON(xhr.responseText))
	    console.log("Error: " + status);
	    console.log(xhr.responseText);
	    responseText = xhr.responseText;
		$('#preview-image').attr('src', xhr.responseText);
	});
*/
	// Retrieve PNG URL via AJAX and embed in page.
	$('#preview-button').click ( function(e) {
		e.preventDefault();
		previewImage = $('#preview-image');
		var oldImage = previewImage.attr('src');
		previewImage.attr('src', "<%= asset_path 'loading.gif' %>" );
		$.ajax({
			type: "POST",
			url: "/charts/preview",
			data: $('.chart_form').serialize(),
			dataType: 'text',
			success: function(data, status, xhr) {
				console.log('success');
				console.log(xhr.responseText);
				//$('#chart').val(data);
				previewImage.attr('src', xhr.responseText);
			},
			error: function(xhr, status, error) {
				console.log(error);
				console.log(xhr.responseText);
				previewImage.attr('src', oldImage);
				//$('#preview-image').attr('src', xhr.responseText);
			}
		});
	});

	// Submit data to download action.
	$('#pdf-button').click ( function(e) {
		e.preventDefault();
		var form = $('.chart_form');
		var oldAction = form.attr('action');
		form.attr('action', "/charts/download").submit();
		form.attr('action', oldAction);
	});
});